---
layout: single
title:  "DeepSeek-V3 Review"
categories: Study-concept
tag: [DeepSeek, DeepSeek-V3, MLA, MoE, MTP, Mixed-precision, Hopper architecture]
toc: true
author_profile: false
sidebar:
    nav: "docs"
search: true
typora-root-url: ../
---





#  DeepSeek-V3 Review

ğŸ‘‰ğŸ»[ë…¼ë¬¸ ë§í¬](https://arxiv.org/abs/2412.19437 "DeepSeek V3") 

DeepSeek-V3ì— ëŒ€í•œ ë¦¬ë·°ëŠ” ì´ë¯¸ ë§ì´ ë‚˜ì™”ë‹¤. ë‹¨ìˆœí•œ ì„±ëŠ¥ ë¹„êµë‚˜ ë²¤ì¹˜ë§ˆí¬ ê²°ê³¼ë¥¼ ë‚˜ì—´í•˜ëŠ” ê²ƒì€ ì˜ë¯¸ê°€ ì—†ë‹¤ê³  ìƒê°í•œë‹¤.

ëŒ€ì‹ , ì´ë²ˆ ë¦¬ë·°ì—ì„œëŠ” **ìµœì ì˜ ì„±ëŠ¥ì„ ëŒì–´ë‚´ëŠ” íŠ¸ëœìŠ¤í¬ë¨¸ ì•„í‚¤í…ì²˜ì˜ ì„¤ê³„ì™€ íš¨ìœ¨ì ì¸ í•™ìŠµì„ ìœ„í•œ í˜¼í•© ì •ë°€ë„ í™œìš©**ì— ì§‘ì¤‘í•˜ë ¤ í•œë‹¤.

íŠ¹íˆ,

- ì „í†µì ì¸ ë””ì½”ë” ê¸°ë°˜ íŠ¸ëœìŠ¤í¬ë¨¸ ëª¨ë¸ì„ ì–´ë–¤ ê¸°ìˆ ë“¤ì„ ì ìš©í•´ì„œ **ê°œì„ ì„ ê±°ë“­**í•˜ì—¬ ì „ë°˜ì ì¸ íš¨ìœ¨ ë° ì„±ëŠ¥ì„ í–¥ìƒì‹œì¼°ëŠ”ì§€
- Nvidia Hopper Architectureë¥¼ ìµœëŒ€í•œ í™œìš©í•œ **FP8 mixed precision**ì´ ì–´ë–»ê²Œ ì„±ëŠ¥ì€ ìœ ì§€í•˜ë©´ì„œë„ ìì› ë° ì‹œê°„ì„ ì ˆê°ì‹œì¼°ëŠ”ì§€
- ê¸°íƒ€ í•™ìŠµ hyper-parameters

ì´ ì„¸ ê°€ì§€ í•µì‹¬ ìš”ì†Œë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ë¶„ì„í•´ë³´ë ¤ê³  í•œë‹¤. DeepSeek-V3ì˜ ì•„í‚¤í…ì²˜ì™€ í•™ìŠµ ê¸°ë²•ì´ ê¸°ì¡´ ëª¨ë¸ê³¼ ì–´ë–¤ ì°¨ë³„ì ì„ ê°€ì§€ëŠ”ì§€ ì‚´í´ë³´ì.



# Architectures

- DeepSeek V3ì˜ ì•„í‚¤í…ì²˜ëŠ” ê¸°ì¡´ì˜ ì „í†µì ì¸ ë””ì½”ë” ê¸°ë°˜ íŠ¸ëœìŠ¤í¬ë¨¸ ëª¨ë¸ ëŒ€ë¹„ 3ê°€ì§€ê°€ ë‹¤ë¦„
  - MLA
    - MLAëŠ” ë”¥ì‹œí¬ì˜ ë…ìì  êµ¬ì¡°
  - MoE
    - MoEëŠ” ë§ì´ ì¡´ì¬í•´ì™“ìœ¼ë‚˜ ë”¥ì‹œí¬ë§Œì˜ ì•„ì´ë””ì–´ ì²¨ê°€(auxiliary-loss free strategy, default top p)
  - MTP
    - MTPëŠ” ê¸°ì¡´ì´ë‚˜ ë©”ë‘ì‚¬ì™€ ê°™ì´ LM headë¥¼ ë‚˜ëˆ„ëŠ”ê²Œ ì•„ë‹ˆë¼ lm headëŠ” ê³µìœ , íŠ¸ëœìŠ¤í¬ë¨¸ ë¸”ë¡ì— ì¬ê·€ì ìœ¼ë¡œ íƒœìš°ëŠ” ë°©ì‹
    - ì¶”ë¡  ëª¨ë¸ë§ ì½”ë“œì—ëŠ” êµ¬í˜„ë˜ì–´ìˆì§€ ì•Šì•„ì„œ êµ¬ì²´ì ìœ¼ë¡œ ì•Œ ìˆ˜ëŠ” ì—†ìŒ

ì‹œì‘



DeepSeek-V3ì˜ ì•„í‚¤í…ì²˜ëŠ” ê¸°ì¡´ì˜ **ì „í†µì ì¸ ë””ì½”ë” ê¸°ë°˜ íŠ¸ëœìŠ¤í¬ë¨¸ ëª¨ë¸**ê³¼ ë¹„êµí–ˆì„ ë•Œ ì„¸ ê°€ì§€ ì¤‘ìš”í•œ ì°¨ì´ì ì„ ê°€ì§„ë‹¤.



1. **Multi-head Latent Attention(MLA)**
   ê¸°ì¡´ì˜ ì–´í…ì…˜ ë©”ì»¤ë‹ˆì¦˜ì€ ëª¨ë¸ í¬ê¸°ê°€ ì»¤ì§ˆìˆ˜ë¡ ì—°ì‚°ëŸ‰ê³¼ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ ì¦ê°€í•˜ëŠ” ë¬¸ì œë¥¼ ì•ˆê³  ìˆì—ˆë‹¤. DeepSeek-V3ëŠ” ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ **MLA(Multi-head Latent Attention)**ë¼ëŠ” ìì²´ì ì¸ ì–´í…ì…˜ êµ¬ì¡°ë¥¼ ë„ì…í–ˆë‹¤. MLAëŠ” ê¸°ì¡´ì˜ Multi-Head Attention(MHA)ì™€ ë‹¬ë¦¬ **Q, K, V í–‰ë ¬ì„ ì²˜ìŒë¶€í„° LoRA(Low-Rank Adaptation) ë°©ì‹ìœ¼ë¡œ êµ¬ì„±**í•˜ê³ , Kì™€ Vë¥¼ **í•˜ë‚˜ì˜ projectionì—ì„œ ìƒì„±**í•˜ì—¬ ëª¨ë¸ì˜ íŒŒë¼ë¯¸í„° íš¨ìœ¨ì„±ì„ ê·¹ëŒ€í™”í–ˆë‹¤. ë˜í•œ, MLAëŠ” ê¸°ì¡´ RoPE(Rotary Position Embedding)ì™€ í•¨ê»˜ **NoPE(No Position Embedding)** ë°©ì‹ì„ í˜¼ìš©í•˜ì—¬ ë‹¤ì–‘í•œ ìœ„ì¹˜ ì¸ì½”ë”© ì „ëµì„ ì ìš©í–ˆë‹¤. MLAëŠ” GQA(Grouped Query Attention) ë° MQA(Multi-query Attention) ë°©ì‹ì„ **í˜¼í•©ì ìœ¼ë¡œ ì‚¬ìš©**í•˜ì—¬, ì—°ì‚° íš¨ìœ¨ì„ ìœ ì§€í•˜ë©´ì„œë„ ë†’ì€ ì„±ëŠ¥ì„ í™•ë³´í–ˆë‹¤.

   

2. **Mixture of Experts(MoE)**
   MoE(Mixture of Experts)ëŠ” ê¸°ì¡´ì—ë„ ì—¬ëŸ¬ ëª¨ë¸ì—ì„œ í™œìš©ëœ ê¸°ë²•ì´ì§€ë§Œ, DeepSeek-V3ëŠ” ì´ë¥¼ ë”ìš± ë°œì „ì‹œì¼°ë‹¤. ì¼ë°˜ì ì¸ MoE ëª¨ë¸ì—ì„œëŠ” ì „ë¬¸ê°€ ë„¤íŠ¸ì›Œí¬ ê°„ì˜ ê· í˜•ì„ ë§ì¶”ê¸° ìœ„í•´ auxiliary lossë¥¼ ì¶”ê°€ì ìœ¼ë¡œ ì‚¬ìš©í•˜ì§€ë§Œ, DeepSeek-V3ëŠ” **auxiliary-loss free strategy**ë¥¼ ë„ì…í•˜ì—¬ ì´ëŸ¬í•œ ì¶”ê°€ì ì¸ ì†ì‹¤ ì—†ì´ë„ ì „ë¬¸ê°€ ë„¤íŠ¸ì›Œí¬ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ í™œìš©í•  ìˆ˜ ìˆë„ë¡ í–ˆë‹¤. ë˜í•œ, **ê¸°ë³¸ì ìœ¼ë¡œ Top-p ë°©ì‹ì˜ ì „ë¬¸ê°€ ì„ íƒ(default top-p strategy)ì„ ì±„íƒ**, íŠ¹ì • ì „ë¬¸ê°€ê°€ ê³¼ë„í•˜ê²Œ í™œì„±í™”ë˜ëŠ” ë¬¸ì œë¥¼ ë°©ì§€í•˜ê³  ë³´ë‹¤ ê· í˜• ì¡íŒ í•™ìŠµì´ ì´ë£¨ì–´ì§€ë„ë¡ ì„¤ê³„í–ˆë‹¤. ì´ëŸ¬í•œ ì ‘ê·¼ ë°©ì‹ì€ ëª¨ë¸ì´ ë”ìš± ì•ˆì •ì ì´ê³  íš¨ìœ¨ì ìœ¼ë¡œ í•™ìŠµí•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤€ë‹¤.

   

3. **Multi-Token Prediction(MTP)**
   ê¸°ì¡´ì˜ MTP(Multi-Token Prediction) ë°©ì‹ì€ íŠ¸ëœìŠ¤í¬ë¨¸ ê¸°ë°˜ ëª¨ë¸ì—ì„œ í•™ìŠµ ì†ë„ë¥¼ ë†’ì´ê¸° ìœ„í•´ ìì£¼ ì‚¬ìš©ë˜ì—ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œëŠ” Medusaì™€ ê°™ì€ êµ¬ì¡°ì—ì„œ LM headë¥¼ ì—¬ëŸ¬ ê°œë¡œ ë‚˜ëˆ„ì–´ ê° headê°€ ë‹¤ë¥¸ í† í°ì„ ì˜ˆì¸¡í•˜ëŠ” ë°©ì‹ì´ì—ˆì§€ë§Œ, DeepSeek-V3ëŠ” **LM headë¥¼ ê³µìœ í•˜ë©´ì„œ Transformer ë¸”ë¡ì„ ì¬ê·€ì ìœ¼ë¡œ í™œìš©í•˜ëŠ” ë°©ì‹**ì„ ì±„íƒí–ˆë‹¤. ì´ë¥¼ í†µí•´ íŒŒë¼ë¯¸í„° ìˆ˜ë¥¼ ì¦ê°€ì‹œí‚¤ì§€ ì•Šìœ¼ë©´ì„œë„ í•œ ë²ˆì˜ forward passì—ì„œ ì—¬ëŸ¬ ê°œì˜ í† í°ì„ ì˜ˆì¸¡í•  ìˆ˜ ìˆë„ë¡ ì„¤ê³„ë˜ì—ˆë‹¤. ë‹¤ë§Œ, í˜„ì¬ ê³µê°œëœ **DeepSeek-V3ì˜ ì¶”ë¡  ëª¨ë¸ë§ ì½”ë“œì—ëŠ” í•´ë‹¹ MTP ê¸°ë²•ì´ êµ¬í˜„ë˜ì–´ ìˆì§€ ì•Šì•„** ì‹¤ì œ í•™ìŠµ ê³¼ì •ì—ì„œ ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ ì ìš©ë˜ëŠ”ì§€ëŠ” êµ¬ì²´ì ìœ¼ë¡œ í™•ì¸í•  ìˆ˜ ì—†ë‹¤.

   

ì´ëŸ¬í•œ ì„¸ ê°€ì§€ í•µì‹¬ì ì¸ ì°¨ë³„ì ì„ í†µí•´ DeepSeek-V3ëŠ” **ë™ì¼í•œ íŒŒë¼ë¯¸í„° ìˆ˜ì—ì„œ ë” ë‚˜ì€ ì„±ëŠ¥ì„ ì œê³µí•˜ë©´ì„œë„ ì—°ì‚° íš¨ìœ¨ì„±ì„ ê·¹ëŒ€í™”í•˜ëŠ” êµ¬ì¡°ë¥¼ ê°–ì¶”ì—ˆë‹¤**. ë‹¤ìŒìœ¼ë¡œëŠ” ê° ì•„í‚¤í…ì²˜ì— ëŒ€í•´ ë”ìš± ìƒì„¸íˆ ë¶„ì„í•´ë³´ì.



## Multi-head Latent Attention(MLA)

DeepSeek-V3ì—ì„œ ê°€ì¥ ëˆˆì— ë„ëŠ” ì°¨ë³„ì  ì¤‘ í•˜ë‚˜ëŠ” **Multi-head Latent Attention(MLA)**ì´ë‹¤. ê¸°ì¡´ì˜ íŠ¸ëœìŠ¤í¬ë¨¸ ëª¨ë¸ì—ì„œ ì‚¬ìš©ë˜ëŠ” **Multi-Head Attention(MHA)**ëŠ” ê° í—¤ë“œë§ˆë‹¤ ë…ë¦½ì ì¸ Key(K)ì™€ Value(V)ë¥¼ ìƒì„±í•˜ëŠ” ë°©ì‹ì´ì—ˆì§€ë§Œ, MLAëŠ” ì´ë¥¼ ê°œì„ í•˜ì—¬ **ì—°ì‚°ëŸ‰ê³¼ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì„ ì¤„ì´ë©´ì„œë„ ì„±ëŠ¥ì„ ìœ ì§€í•˜ëŠ” ë°©ì‹**ì„ ë„ì…í–ˆë‹¤.



### 1. MLAì˜ í•µì‹¬ ê°œë…

ì¼ë°˜ì ì¸ íŠ¸ëœìŠ¤í¬ë¨¸ì—ì„œëŠ” Q, K, V í–‰ë ¬ì„ ê° í—¤ë“œë§ˆë‹¤ ë…ë¦½ì ìœ¼ë¡œ ìƒì„±í•˜ì§€ë§Œ, DeepSeek-V3ì˜ MLAëŠ” **LoRA(Low-Rank Adaptation) ê¸°ë²•ì„ í™œìš©í•˜ì—¬ Q, K, Vë¥¼ ì²˜ìŒë¶€í„° ê²½ëŸ‰í™”ëœ í˜•íƒœë¡œ ìƒì„±**í•œë‹¤. íŠ¹íˆ, **Kì™€ Vë¥¼ í•˜ë‚˜ì˜ projectionì—ì„œ ìƒì„±**í•˜ëŠ” êµ¬ì¡°ë¥¼ ê°–ì¶”ê³  ìˆì–´, íŒŒë¼ë¯¸í„° ìˆ˜ë¥¼ ì¤„ì´ë©´ì„œë„ ìœ ì‚¬í•œ ì–´í…ì…˜ ì„±ëŠ¥ì„ ìœ ì§€í•  ìˆ˜ ìˆë„ë¡ ì„¤ê³„ë˜ì—ˆë‹¤.



![MLA](/images/2025-02-19-DeepSeek-V3/deepseek-mla.png){: .align-center}



ğŸ‘‰ **[MLA ì½”ë“œ ìº¡ì²˜ ìœ„ì¹˜]**
ğŸ“Œ *ì•„ë˜ ìº¡ì²˜ëŠ” MLAì—ì„œ LoRAë¥¼ í™œìš©í•˜ì—¬ Q, K, Vë¥¼ ìƒì„±í•˜ëŠ” ì½”ë“œ ë¶€ë¶„ì„ ë³´ì—¬ì¤€ë‹¤.*

> **ì½”ë“œ ìº¡ì²˜: MLAì—ì„œ Q, K, Vë¥¼ LoRAë¡œ ìƒì„±í•˜ëŠ” ë¶€ë¶„**



### 2. RoPE vs. NoPE: MLAì—ì„œì˜ ìœ„ì¹˜ ì¸ì½”ë”© ë°©ì‹

MLAëŠ” **RoPE(Rotary Position Embedding)ì™€ NoPE(No Position Embedding)ë¥¼ ë™ì‹œì— ì§€ì›**í•˜ëŠ” êµ¬ì¡°ë¥¼ ê°–ì¶”ê³  ìˆë‹¤.

- **RoPE**ëŠ” ê¸°ì¡´ Llama ì‹œë¦¬ì¦ˆì—ì„œ ì‚¬ìš©ëœ ë°©ì‹ìœ¼ë¡œ, ìƒëŒ€ì  ìœ„ì¹˜ ì •ë³´ë¥¼ ì–´í…ì…˜ ë©”ì»¤ë‹ˆì¦˜ì— ìì—°ìŠ¤ëŸ½ê²Œ ì£¼ì…í•  ìˆ˜ ìˆëŠ” ê°•ì ì„ ê°€ì§„ë‹¤.

- NoPE

  ëŠ” íŠ¹ì •í•œ ìœ„ì¹˜ ì¸ì½”ë”©ì„ ì‚¬ìš©í•˜ì§€ ì•Šê³ , MLA ìì²´ì˜ í•™ìŠµ ê³¼ì •ì—ì„œ ìì—°ìŠ¤ëŸ½ê²Œ íŒ¨í„´ì„ ìµíˆë„ë¡ í•˜ëŠ” ë°©ì‹ì´ë‹¤.

  - MLAì—ì„œëŠ” GQA(Grouped Query Attention) ë° MQA(Multi-Query Attention)ë¥¼ **ë™ì‹œì— í™œìš©**í•  ìˆ˜ ìˆë„ë¡ ì„¤ê³„ë˜ì—ˆìœ¼ë©°, ì´ë•Œ Key í—¤ë“œ ì°¨ì›(`k head dim`)ì´ 1ì´ë©´ **RoPE ë˜ëŠ” NoPE ë°©ì‹ ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•˜ì—¬ ì ìš©**í•œë‹¤.

ğŸ‘‰ **[RoPE vs. NoPE ë¹„êµ í”¼ê·œì–´ ìœ„ì¹˜]**
ğŸ“Œ *ì•„ë˜ ê·¸ë¦¼ì€ MLAì—ì„œ RoPEì™€ NoPEë¥¼ ì ìš©í•˜ëŠ” êµ¬ì¡°ì  ì°¨ì´ë¥¼ ì‹œê°ì ìœ¼ë¡œ ë³´ì—¬ì¤€ë‹¤.*

> **í”¼ê·œì–´ ìº¡ì²˜: MLAì—ì„œ RoPEì™€ NoPEê°€ ì ìš©ëœ êµ¬ì¡° ë¹„êµ**



### 3. MLAì™€ ê¸°ì¡´ Llama ì–´í…ì…˜ì˜ ì°¨ì´ì 

ê¸°ì¡´ì˜ Llama ëª¨ë¸ì—ì„œë„ ì–´í…ì…˜ ìµœì í™”ë¥¼ ìœ„í•œ ì—¬ëŸ¬ ê¸°ë²•ì´ ì ìš©ë˜ì—ˆì§€ë§Œ, MLAëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì¶”ê°€ì ì¸ ê°œì„ ì ì„ í¬í•¨í•˜ê³  ìˆë‹¤.

- **LoRA ê¸°ë°˜ì˜ ê²½ëŸ‰ Q, K, V ìƒì„±**
- **K, Vë¥¼ í•˜ë‚˜ì˜ projectionì—ì„œ ì¶”ì¶œí•˜ì—¬ ë©”ëª¨ë¦¬ íš¨ìœ¨ì„± ì¦ê°€**
- **RoPE ë° NoPE ì„ íƒ ê°€ëŠ¥ (GQA, MQA ë™ì‹œ í™œìš© ê°€ëŠ¥)**

ğŸ‘‰ **[ê¸°ì¡´ Llama ì–´í…ì…˜ vs. MLA ë¹„êµ í”¼ê·œì–´ ìœ„ì¹˜]**
ğŸ“Œ *ì•„ë˜ ê·¸ë¦¼ì€ ê¸°ì¡´ Llama ëª¨ë¸ê³¼ DeepSeek-V3ì˜ MLAë¥¼ ë¹„êµí•˜ì—¬ ì°¨ì´ì ì„ ë³´ì—¬ì¤€ë‹¤.*

> **í”¼ê·œì–´ ìº¡ì²˜: Llama ì–´í…ì…˜ vs. MLA ë¹„êµ**



### 4. MLAì˜ ì„±ëŠ¥ ë° ê¸°ëŒ€ íš¨ê³¼

ì´ëŸ¬í•œ ì„¤ê³„ë¥¼ í†µí•´ MLAëŠ” ê¸°ì¡´ MHA ëŒ€ë¹„ **ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì„ ì¤„ì´ë©´ì„œë„ ë™ì¼í•œ ìˆ˜ì¤€ì˜ ì„±ëŠ¥ì„ ìœ ì§€**í•˜ëŠ” ë° ì´ˆì ì„ ë§ì·„ë‹¤. íŠ¹íˆ, **LoRAë¥¼ í™œìš©í•œ Q, K, V ìƒì„±ê³¼ K, Vì˜ ë‹¨ì¼ projection ì‚¬ìš©ìœ¼ë¡œ ì¸í•´ ì—°ì‚°ëŸ‰ì„ ì ˆê°**í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì´ í° ì¥ì ì´ë‹¤.

ğŸ‘‰ **[MLA ì½”ë“œ ì „ì²´ êµ¬ì¡° ìº¡ì²˜ ìœ„ì¹˜]**
ğŸ“Œ *ì•„ë˜ ìº¡ì²˜ëŠ” MLA ì „ì²´ êµ¬í˜„ ì½”ë“œë¡œ, ê¸°ì¡´ MHAì™€ì˜ ì°¨ë³„ì ì„ ê°•ì¡°í•œë‹¤.*

> **ì½”ë“œ ìº¡ì²˜: MLAì˜ ì „ì²´ ì–´í…ì…˜ êµ¬í˜„ êµ¬ì¡°**

ê²°ë¡ ì ìœ¼ë¡œ, MLAëŠ” ê¸°ì¡´ ì–´í…ì…˜ êµ¬ì¡°ì—ì„œ ë°œìƒí•˜ëŠ” **ë©”ëª¨ë¦¬ ë° ì—°ì‚°ëŸ‰ ë¬¸ì œë¥¼ íš¨ê³¼ì ìœ¼ë¡œ ê°œì„ í•˜ë©´ì„œë„ ì„±ëŠ¥ì„ ìœ ì§€í•˜ëŠ” ë…ìì ì¸ DeepSeek-V3ì˜ í•µì‹¬ ì•„í‚¤í…ì²˜**ë¼ í•  ìˆ˜ ìˆë‹¤.





## Mixture of Experts(MoE)

ğŸ‘‰ğŸ»[DeepSeek MoE ë…¼ë¬¸ ë§í¬](https://arxiv.org/pdf/2401.06066 "DeepSeek MoE") 

DeepSeek-V3ëŠ” ê¸°ì¡´ì—ë„ ë„ë¦¬ ì‚¬ìš©ë˜ë˜ **Mixture of Experts (MoE)** êµ¬ì¡°ë¥¼ ì±„íƒí–ˆì§€ë§Œ, ë‹¨ìˆœí•œ MoE ëª¨ë¸ì´ ì•„ë‹ˆë¼ **íš¨ìœ¨ì„±ê³¼ ê· í˜•ì„ ìµœì í™”í•œ ìƒˆë¡œìš´ ì „ëµì„ ë„ì…**í–ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ MoEëŠ” ê±°ëŒ€í•œ ëª¨ë¸ì—ì„œ ì—°ì‚°ëŸ‰ì„ ì¤„ì´ë©´ì„œë„ ì„±ëŠ¥ì„ ìœ ì§€í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ê°•ë ¥í•œ ê¸°ë²•ì´ì§€ë§Œ, ì „ë¬¸ê°€ ë„¤íŠ¸ì›Œí¬ ê°„ì˜ **ë¶€í•˜ ë¶ˆê· í˜•(Load Imbalance) ë¬¸ì œ**ì™€ **ì¶”ê°€ì ì¸ auxiliary loss í•„ìš”ì„±**ì´ ë‹¨ì ìœ¼ë¡œ ì§€ì ë˜ì–´ ì™”ë‹¤. DeepSeek-V3ëŠ” ì´ëŸ¬í•œ í•œê³„ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ **auxiliary-loss free strategy**ì™€ **default top-p gating** ê¸°ë²•ì„ ë„ì…í–ˆë‹¤.



### 1. MoEì˜ ê¸°ë³¸ ê°œë…

MoEëŠ” ì—¬ëŸ¬ ê°œì˜ ì „ë¬¸ê°€(Expert) ë„¤íŠ¸ì›Œí¬ ì¤‘ ì¼ë¶€ë§Œ í™œì„±í™”í•˜ì—¬ ëª¨ë¸ì˜ ì—°ì‚° íš¨ìœ¨ì„±ì„ ê·¹ëŒ€í™”í•˜ëŠ” ë°©ì‹ì´ë‹¤. ì¼ë°˜ì ìœ¼ë¡œëŠ” **Gating Network**ê°€ ì…ë ¥ì„ ë°›ì•„ ì „ë¬¸ê°€ë¥¼ ì„ íƒí•˜ë©°, ì„ íƒëœ ì „ë¬¸ê°€ë§Œ í™œì„±í™”ëœë‹¤. ì´ë¥¼ í†µí•´ ê±°ëŒ€í•œ ëª¨ë¸ë„ ì¼ë¶€ íŒŒë¼ë¯¸í„°ë§Œì„ ì‚¬ìš©í•˜ì—¬ ì—°ì‚°ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ **ì¶”ë¡  ì†ë„ê°€ ë¹¨ë¼ì§€ê³  ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ ê°ì†Œ**í•˜ëŠ” íš¨ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤.



![MoE](/images/2025-02-19-DeepSeek-V3/deepseek-moe.png){: .align-center}



ğŸ‘‰ **[MoE í”¼ê·œì–´ ìœ„ì¹˜]**
ğŸ“Œ *ì•„ë˜ í”¼ê·œì–´ëŠ” ì¼ë°˜ì ì¸ MoE êµ¬ì¡°ë¥¼ ì„¤ëª…í•˜ë©°, Gating Networkê°€ ì–´ë–»ê²Œ íŠ¹ì • ì „ë¬¸ê°€ë¥¼ ì„ íƒí•˜ëŠ”ì§€ ë³´ì—¬ì¤€ë‹¤.*

> **í”¼ê·œì–´ ìº¡ì²˜: ì¼ë°˜ì ì¸ MoE êµ¬ì¡° ë° Gating Mechanism**



### 2. DeepSeek-V3ì˜ MoE ê°œì„ ì 

DeepSeek-V3ì˜ MoEëŠ” ê¸°ì¡´ì˜ MoEì™€ ë¹„êµí–ˆì„ ë•Œ ë‹¤ìŒê³¼ ê°™ì€ ë‘ ê°€ì§€ ì£¼ìš” ì°¨ë³„ì ì„ ê°€ì§„ë‹¤.

#### (1) Auxiliary-Loss Free Strategy

ê¸°ì¡´ MoE ëª¨ë¸ì—ì„œëŠ” íŠ¹ì • ì „ë¬¸ê°€(Expert)ë§Œ ì§€ë‚˜ì¹˜ê²Œ í™œì„±í™”ë˜ëŠ” í˜„ìƒì´ ë°œìƒí•˜ëŠ”ë°, ì´ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ ë³´í†µ **auxiliary loss**ë¥¼ ì¶”ê°€ë¡œ ì ìš©í•˜ì—¬ ê· í˜•ì„ ë§ì¶˜ë‹¤. í•˜ì§€ë§Œ auxiliary lossëŠ” **ì¶”ê°€ì ì¸ ê³„ì‚° ë¹„ìš©ì´ í•„ìš”**í•˜ê³ , ìµœì ì˜ loss balancingì„ ì°¾ëŠ” ê²ƒì´ ê¹Œë‹¤ë¡­ë‹¤ëŠ” ë‹¨ì ì´ ìˆë‹¤.

DeepSeek-V3ëŠ” ì´ëŸ¬í•œ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ **auxiliary-loss free strategy**ë¥¼ ë„ì…í–ˆë‹¤. ì¦‰, **ë³„ë„ì˜ ì†ì‹¤ í•¨ìˆ˜ ì—†ì´ë„ ì „ë¬¸ê°€ ê°„ì˜ ë¶€í•˜ë¥¼ ìë™ìœ¼ë¡œ ê· í˜• ì¡ë„ë¡ ì„¤ê³„**í–ˆë‹¤. ì´ ë°©ì‹ì€ ë‹¤ìŒê³¼ ê°™ì€ ì¥ì ì„ ê°€ì§„ë‹¤.

- **ì¶”ê°€ì ì¸ loss ê³„ì‚° ì—†ì´ë„ ì „ë¬¸ê°€ ì„ íƒì´ ìì—°ìŠ¤ëŸ½ê²Œ ë¶„ë°°ë¨**
- **Gating Networkì˜ í•™ìŠµì´ ë” ë‹¨ìˆœí•´ì§€ê³ , ìµœì í™”ê°€ ìš©ì´í•´ì§**
- **ì¶”ê°€ì ì¸ hyperparameter íŠœë‹ ì—†ì´ë„ ëª¨ë¸ì˜ ì•ˆì •ì„±ì„ ìœ ì§€**

ğŸ‘‰ **[DeepSeek-V3ì˜ MoE ë…¼ë¬¸ ìˆ˜ì‹ ìº¡ì²˜ ìœ„ì¹˜]**
ğŸ“Œ *ì•„ë˜ ìˆ˜ì‹ì€ auxiliary loss ì—†ì´ë„ ì „ë¬¸ê°€ ë¶„ë°°ë¥¼ ìµœì í™”í•˜ëŠ” DeepSeek-V3ì˜ MoE ë°©ì‹ì„ ì„¤ëª…í•œë‹¤.*

> **ë…¼ë¬¸ ìˆ˜ì‹ ìº¡ì²˜: DeepSeek-V3 MoEì˜ Auxiliary-Loss Free Strategy**

#### (2) Default Top-p Gating Strategy

ì¼ë°˜ì ì¸ MoEì—ì„œëŠ” **Top-k ë°©ì‹**ìœ¼ë¡œ ì „ë¬¸ê°€ë¥¼ ì„ íƒí•˜ëŠ” ê²½ìš°ê°€ ë§ì§€ë§Œ, DeepSeek-V3ëŠ” **Top-p ë°©ì‹**ì„ ê¸°ë³¸ìœ¼ë¡œ ì„¤ì •í•˜ì—¬ ì „ë¬¸ê°€ ì„ íƒì„ ë”ìš± íš¨ìœ¨ì ìœ¼ë¡œ ë§Œë“¤ì—ˆë‹¤.

- **Top-k ë°©ì‹**: kê°œì˜ ì „ë¬¸ê°€ë¥¼ ì„ íƒí•˜ëŠ” ê³ ì •ëœ ë°©ì‹ìœ¼ë¡œ, íŠ¹ì • ì „ë¬¸ê°€ê°€ ì§€ë‚˜ì¹˜ê²Œ ìì£¼ ì„ íƒë˜ëŠ” ê²½í–¥ì´ ìˆìŒ.
- **Top-p ë°©ì‹**: ì„ íƒ í™•ë¥ ì´ ë†’ì€ ì „ë¬¸ê°€ë¶€í„° ìˆœì„œëŒ€ë¡œ ì±„íƒí•˜ë˜, ëˆ„ì  í™•ë¥ ì´ p ì´ìƒì´ ë˜ë©´ ì¤‘ë‹¨í•˜ëŠ” ë°©ì‹.

DeepSeek-V3ì˜ MoEëŠ” **Default Top-p Gating Strategy**ë¥¼ ì±„íƒí•˜ì—¬,

- **ì „ë¬¸ê°€ ê°„ì˜ ë¶ˆê· í˜•ì„ ì¤„ì´ê³  íŠ¹ì • ì „ë¬¸ê°€ê°€ ë…ì ì ìœ¼ë¡œ í™œì„±í™”ë˜ëŠ” ë¬¸ì œë¥¼ ë°©ì§€**
- **ë³´ë‹¤ ìœ ë™ì ì¸ ì „ë¬¸ê°€ ì„ íƒì´ ê°€ëŠ¥í•˜ì—¬ ë°ì´í„°ì— ë”°ë¼ ì ì ˆí•œ ì „ë¬¸ê°€ë¥¼ í™œìš©**
- **ì¶”ê°€ì ì¸ auxiliary loss ì—†ì´ë„ Load Imbalance ë¬¸ì œ í•´ê²°**

ğŸ‘‰ **[DeepSeek-V3ì˜ MoE ì½”ë“œ ìº¡ì²˜ ìœ„ì¹˜]**
ğŸ“Œ *ì•„ë˜ ìº¡ì²˜ëŠ” MoE Gating Networkì—ì„œ Default Top-p ë°©ì‹ì´ ì ìš©ëœ ì½”ë“œ ë¶€ë¶„ì„ ë³´ì—¬ì¤€ë‹¤.*

> **ì½”ë“œ ìº¡ì²˜: DeepSeek-V3 MoEì˜ Default Top-p Gating Strategy êµ¬í˜„**



### 3. DeepSeek-V3 MoEì˜ ì¥ì 

DeepSeek-V3ëŠ” **auxiliary-loss free strategy**ì™€ **default top-p gating**ì„ ì ìš©í•˜ì—¬ ê¸°ì¡´ MoE ëŒ€ë¹„ ë‹¤ìŒê³¼ ê°™ì€ ì¥ì ì„ ê°–ëŠ”ë‹¤.
âœ… **ë¶ˆê· í˜• ë¬¸ì œ í•´ê²°** â†’ íŠ¹ì • ì „ë¬¸ê°€ê°€ ë…ì ì ìœ¼ë¡œ í™œì„±í™”ë˜ëŠ” ë¬¸ì œë¥¼ ë°©ì§€
âœ… **ì¶”ê°€ì ì¸ loss ì—†ì´ ì•ˆì •ì  í•™ìŠµ** â†’ auxiliary lossë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì•„ í•™ìŠµì´ ë‹¨ìˆœí•´ì§€ê³  ìµœì í™”ê°€ ì‰¬ì›Œì§
âœ… **ì—°ì‚° ë¹„ìš© ì ˆê°** â†’ gatingì˜ íš¨ìœ¨ì´ ì¦ê°€í•˜ì—¬ ë¶ˆí•„ìš”í•œ ì „ë¬¸ê°€ í˜¸ì¶œì„ ìµœì†Œí™”
âœ… **ì¶”ë¡  ì†ë„ í–¥ìƒ** â†’ ë™ì ì¸ ì „ë¬¸ê°€ ì„ íƒì„ í†µí•´ ë³´ë‹¤ ì ì€ ì—°ì‚°ëŸ‰ìœ¼ë¡œ ìµœì ì˜ ê²°ê³¼ ë„ì¶œ

ê²°ê³¼ì ìœ¼ë¡œ, DeepSeek-V3ì˜ MoEëŠ” **ê¸°ì¡´ MoE ëª¨ë¸ì˜ í•œê³„ë¥¼ í•´ê²°í•˜ë©´ì„œë„ íš¨ìœ¨ì ì¸ ì „ë¬¸ê°€ ì„ íƒì´ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ê³„ëœ êµ¬ì¡°**ë¼ í•  ìˆ˜ ìˆë‹¤.







## Multi-Token Prediction(MTP)

+ MTPëŠ” train ë‹¨ê³„ì—ì„œ ë§ì´ ì“°ëŠ” ë°©ë²•
+ ê¸°ì¡´ MTP ë°©ë²•ë¡ ë“¤ ì†Œê°œ
+ ê¸°ì¡´ MTP í”¼ê·œì–´ ìº¡ì²˜ ì¶”ê°€
+ deepseekì˜ MTP ì°¨ë³„ì„± ì†Œê°œ
+ deepseek MTP í”¼ê·œì–´ ìº¡ì²˜ ì¶”ê°€
+ ì´ë ‡ê²Œ í•  ë•Œ ì¥ì  ì„¤ëª…
+ modeling deepseekëŠ” ì¶”ë¡  ëª¨ë¸ êµ¬ì„±ì´ë¼ trainì€ ì•Œ ìˆ˜ ì—†ìŒ, ê·¸ë˜ì„œ êµ¬ì²´ì ì¸ êµ¬í˜„ì€ ì•Œ ìˆ˜ ì—†ìŒ

ì‹œì‘



![MTP](/images/2025-02-19-DeepSeek-V3/deepseek-mtp.png){: .align-center}





# Mixed Precision

+ deepseekëŠ” ëŒ€ì¤‘êµ­ gpu ê·œì œë¡œ H100ì˜ ë‹¤ìš´ê·¸ë ˆì´ë“œ ë²„ì „ì¸ H800ë§Œì„ ì‚¬ìš©
+ H100 vs H800 ë¹„êµ ìº¡ì²˜ ì¶”ê°€
+ ê·¸ëŸ¬ë‚˜ H800ë„ hopper ì•„í‚¤í…ì²˜ì„
+ ë”¥ì‹œí¬ëŠ” hopper ì•„í‚¤í…ì²˜ì˜ íŠ¹ì§•ì¸ fp8 í˜¼í•©ì •ë°€ë„ ìµœì í™” ë°©ì‹ì„ ìµœëŒ€í•œ í™œìš©

ì‹œì‘





## FP8 mixed precision

+ deepseekëŠ” ëª¨ë¸ í•™ìŠµ, ì¤‘ê°„ ì €ì¥, ìµœì¢… ì €ì¥ì— fp8, bf16, fp32 ëª¨ë‘ í™œìš©í•¨
+ ì´ì „ ampere ì•„í‚¤í…ì²˜ bf16 í˜¼í•© ì •ë°€ë„ ì„¤ëª…
+ ampere ì•„í‚¤í…í„° ì¥ì  ìº¡ì²˜ ì¶”ê°€
+ ê¸°ì¡´ mixed precision ë°©ì‹ ì„¤ëª…
+ ê¸°ì¡´ mixed precision ë°©ì‹ ìº¡ì²˜ ì¶”ê°€
+ blackwell ì´ì „ ì§€ê¸ˆ ê°€ì¥ ëŒ€ì¤‘ì ì¸ hopper ì•„í‚¤í…ì²˜ì™€ fp8 í˜¼í•© ì •ë°€ë„ ì„¤ëª…
+ hopper ì•„í‚¤í…ì²˜ ì¥ì  ìº¡ì²˜ ì¶”ê°€
+ fp8 mixed precision ë°©ì‹ ì„¤ëª…
+ deepseek mixed precision ë°©ì‹ ìº¡ì²˜ ì¶”ê°€(ê¸°ì¡´ê³¼ ë¹„êµ í•˜ëŠ” ë‚´ìš© ì¶”ê°€ í¸ì§‘í•  ê²ƒ)
+ ê·¸ë˜ì„œ íš¨ìœ¨ì ìœ¼ë¡œ í•™ìŠµì„ ì´ë¤„ëƒ„

ì‹œì‘



![mixed-precision](/images/2025-02-19-DeepSeek-V3/mixed-precision.png){: .align-center}



![backprop-0](/images/2025-02-19-DeepSeek-V3/backprop-0.png){: .align-center}



![backprop-1](/images/2025-02-19-DeepSeek-V3/backprop-1.png){: .align-center}



![backprop-2](/images/2025-02-19-DeepSeek-V3/backprop-2.png){: .align-center}



![backprop-3](/images/2025-02-19-DeepSeek-V3/backprop-3.png){: .align-center}



![backprop-4](/images/2025-02-19-DeepSeek-V3/backprop-4.png){: .align-center}



![backprop-5](/images/2025-02-19-DeepSeek-V3/backprop-5.png){: .align-center}



![backprop-6](/images/2025-02-19-DeepSeek-V3/backprop-6.png){: .align-center}



![backprop-7](/images/2025-02-19-DeepSeek-V3/backprop-7.png){: .align-center}



![deepseek-fp8](/images/2025-02-19-DeepSeek-V3/deepseek-fp8.png){: .align-center}



# Hyper-Parameters

+ deepseekì˜ ë‹¨ê³„ë³„ ëª¨ë¸ íŠ¸ë ˆì´ë‹ í•˜ì´í¼ íŒŒë¼ë¯¸í„° ì •ë¦¬
+ llamaì˜ ë‹¨ê³„ë³„ ëª¨ë¸ íŠ¸ë ˆì´ë‹ í•˜ì´í¼ íŒŒë¼ë¯¸í„°ì™€ ë¹„êµ
+ ì¸ì‚¬ì´íŠ¸ ì¶”ê°€

ì‹œì‘



![deepseek-pretrain-hparams](/images/2025-02-19-DeepSeek-V3/deepseek-pretrain-hparams.png){: .align-center}



![deepseek-long-context-hparams](/images/2025-02-19-DeepSeek-V3/deepseek-long-context-hparams.png){: .align-center}



![deepseek-sft-hparams](/images/2025-02-19-DeepSeek-V3/deepseek-sft-hparams.png){: .align-center}





# í›„ê¸°

+ deepseek v3ë¥¼ ë¦¬ë·°í•˜ë©° ì ì€ ìì› ë‚´ì—ì„œ ìµœëŒ€í•œ íš¨ìœ¨ì„ ë½‘ì•„ë‚´ë ¤ë‹¤ë³´ë‹ˆ ë†€ë¼ìš´ ì—°êµ¬ ì„±ê³¼ê°€ ë‚˜íƒ€ë‚¨
+ ê¸°ì¡´ì˜ ì¡ê¸°ìˆ ë“¤ì„ ëª¨ë‘ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ë„˜ì–´ì„œ ë°œì „ì‹œí‚´
+ ë¬¼ë¡  ë°ì´í„°ì— ëŒ€í•œ ì´ìŠˆëŠ” ìˆì§€ë§Œ ê¸°ìˆ ì˜ ë°œì „ì— ê¸°ì—¬í•œ ê²ƒì€ ë¬´ì‹œë˜ì–´ì„  ì•ˆë¨
+ í•˜ë‚˜í•˜ë‚˜ ì‘ì€ ì¡ê¸°ìˆ ë“¤ì˜ ì ìš©ìœ¼ë¡œ ì¸í•´ í° ì‚°ì„ ë§Œë“¤ì–´ëƒ„
+ ê¸°ìˆ ë„ ì˜ˆìˆ ë„ í° ìë³¸ì—ì„œ ê·œëª¨ì  ë°œì „ì„ ì´ë¤„ë‚¸ë‹¤ë©´, ê²°í•ì—ì„œëŠ” í˜ì‹ ì„ ì´ë¤„ë‚¸ë‹¤

ì‹œì‘

